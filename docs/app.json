[{"name":"app.R","content":"# Install and load required packages\r\nwebr::install(\"shiny\")\r\nwebr::install(\"plotly\")\r\nwebr::install(\"ggtext\")\r\nwebr::install(\"readr\")\r\nwebr::install(\"bslib\")\r\n\r\nlibrary(shiny)\r\nlibrary(plotly)\r\nlibrary(ggtext)\r\nlibrary(readr)\r\nlibrary(bslib)\r\n\r\ndf_plot_long <- read_csv('https://raw.githubusercontent.com/datadrivenenvirolab/smogstrippes_web/main/data/data_shiny_min.csv')\r\ndput(df_plot_long)\r\n\r\nwho_palette_2021 <- c(\"Within Recommended Value of 5µg/m^3\"= \"#00E400\", \r\n                      \"Within WHO Interim Target 4 of 10µg/m^3\" = \"#FB6A4A\", \r\n                      \"Within WHO Interim Target 3 of 15µg/m^3\"=\"#EF3B2C\", \r\n                      \"Within WHO Interim Target 2 of 25µg/m^3\" = \"#CB181D\", \r\n                      \"Within WHO Interim Target 1 of 35µg/m^3\" = \"#A50F15\", \r\n                      \"Exceeding All Recommended Guidelines & Targets\" = \"#67000D\")\r\nwho_palette_2005 <- c(\"Within Recommended Value of 10µg/m^3\" = \"#00E400\",            \r\n                      \"Within WHO Interim Target 3 of 15µg/m^3\" = \"#EF3B2C\", \r\n                      \"Within WHO Interim Target 2 of 25µg/m^3\" = \"#CB181D\", \r\n                      \"Within WHO Interim Target 1 of 35µg/m^3\" = \"#A50F15\", \r\n                      \"Exceeding All Recommended Guidelines & Targets\" =\"#67000D\")\r\n\r\n\r\n# UI\r\nui <- page_navbar(\r\n  selected = \"Smogstripes\",\r\n  collapsible = TRUE,\r\n  theme = bslib::bs_theme(),\r\n  sidebar = sidebar(\r\n    title = \"Sidebar Title\",\r\n    radioButtons(\r\n      choices = unique(df_plot_long$who_year),\r\n      selected = unique(df_plot_long$who_year)[1],\r\n      width = \"100%\",\r\n      inputId = \"who_select\",\r\n      label = \"Select WHO Standard:\"\r\n    ),\r\n    selectizeInput(\"cities_select\", \"Select Cities:\", choices = unique(df_plot_long$city), \r\n                                       multiple = TRUE,\r\n                                       options = list(maxItems = 6),\r\n                                       selected = df_plot_long$city %>% unique() %>% sample(12))\r\n  ),\r\n  nav_panel(\r\n    title = \"Smogstripes\",\r\n    plotlyOutput(outputId = \"main_plot\")\r\n  )\r\n)\r\n\r\n\r\n# Server\r\nserver <- function(input, output) {\r\n  output$main_plot <- renderPlotly({\r\n    filtered_data <- df_plot_long[df_plot_long$city %in% input$cities_select & df_plot_long$who_year == input$who_select, ]\r\n    \r\n    # Your ggplot code\r\n    aq_stripe <- ggplot(filtered_data,\r\n                        aes(x = year, y = 1, fill = who_val))+ \r\n      geom_tile() +\r\n      scale_y_continuous(expand = c(0, 0)) +\r\n      scale_fill_manual(values = get(paste0('who_palette_', unique(filtered_data$who_year)))) +\r\n      guides(fill = guide_colorbar(barwidth = 1))+\r\n      guides(fill = guide_legend(title = paste0(\"WHO Guidelines (\", unique(filtered_data$who_year),\")\"))) +\r\n      labs(title = paste0(\"1998-2022 AIR QUALITY BY WHO GUIDELINES (\", unique(filtered_data$who_year),\")\"))+\r\n      theme_minimal() +\r\n      theme(axis.text.y = element_blank(),\r\n            axis.line.y = element_blank(),\r\n            axis.title = element_blank(),\r\n            panel.grid.major = element_blank(),\r\n            legend.title = element_blank(),\r\n            legend.position = 'top',\r\n            legend.box = \"horizontal\",\r\n            #axis.text.x = element_text(vjust = 3),\r\n            axis.text.x = element_blank(),\r\n            # axis.text.x = element_text(angle=90),\r\n            panel.grid.minor = element_blank(),\r\n            plot.title = element_text(size = 14, face = \"bold\"),\r\n            plot.subtitle = element_textbox_simple(size = 10),\r\n            plot.margin = margin(1, 0, 0, 0, \"cm\"),\r\n            strip.text = ggtext::element_markdown(),\r\n            strip.text.x = element_text(size=11, face=\"bold\")\r\n      )+# Adjust theme as needed\r\n      facet_wrap(~trend)\r\n    \r\n    # Convert ggplot object to plotly\r\n    p <- ggplotly(aq_stripe, tooltip= \"all\")\r\n      # layout(title = list(text = paste0(\"1998-2022 AIR QUALITY BY WHO GUIDELINES (\", unique(filtered_data$who_year),\")\") ,\r\n      #                     x = 0, y = 1,\r\n      #                     pad = list(b = 60, l = 0, r = 0 )))\r\n    \r\n    p\r\n  })\r\n}\r\n\r\n# Run the app\r\nshinyApp(ui, server)\r\n","type":"text"}]
